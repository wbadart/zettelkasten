<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Lenses - My Zettelkasten</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Lenses are 997fa496 which focus on a single item within a structure. A lens must never fail to get or modify the item in focus. Because a lens can always get a focus or set its value, it can also modify it using a function of the current value (e.g. increment it) (commonly called over)." name="description" /><meta content="Lenses" property="og:title" /><meta content="My Zettelkasten" property="og:site_name" /><meta content="article" property="og:type" /><meta content="89c5b6c3" property="neuron:zettel-id" /><meta content="89c5b6c3" property="neuron:zettel-slug" /><script type="application/ld+json">[]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(33,133,208,0.1)}body nav.bottomPane{background-color:rgba(33,133,208,2.0e-2)}body div#footnotes{border-top-color:#2185d0}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#2185d0;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(33,133,208,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><!-- MathJax -->
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- Prism.js -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
<!-- Graphviz -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js" integrity="sha512-vnRdmX8ZxbU+IhA2gLhZqXkX1neJISG10xy0iP0WauuClu3AIMknxyDjYHEpEhi8fTZPyOCWgqUCnEafDB/jVQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js" integrity="sha512-1zKK2bG3QY2JaUPpfHZDUMe3dwBwFdCDwXQ01GrKSd+/l0hqPbF+aak66zYPUZtn+o2JYi1mjXAqy5mW04v3iA==" crossorigin="anonymous"></script>
<script>
window.addEventListener("load", function(){
  let viz = new Viz();
  for (let element of document.getElementsByClassName("graphviz")) {
    let parent = element.parentNode
    let pparent = parent.parentNode
    viz.renderSVGElement(element.textContent)
    .then(function(element) {
      element.setAttribute("width", "100%")
      pparent.replaceChild(element, parent)
    });
  }
});
</script>
<!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><nav class="flipped tree deemphasized" id="zettel-uptree" style="transform-origin: 50%"><ul class="root"><li><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2021-07-26T18:52"><a href="997fa496">Optics</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-11-09T12:02"><a href="d33283e3">Computer Science</a></span></span></div></li></ul></li></ul></li></ul></nav><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Lenses</h1><p>Lenses are <span class="zettel-link-container cf"><span class="zettel-link" title="2021-07-26T18:52"><a href="997fa496">Optics</a></span></span> which focus on a single item within a structure. A lens must never fail to get or modify the item in focus. Because a lens can always get a focus or set its value, it can also modify it using a function of the current value (e.g. increment it) (commonly called <code>over</code>).</p><p>For example,</p><pre><code class="haskell language-haskell">{-# LANGUAGE TemplateHaskell #-}
import Control.Lens

data Foo = Foo { _x :: (Bool, String) } deriving Show
makeLenses &#39;&#39;Foo

&gt;&gt;&gt; Foo {_x = (True, &quot;hi&quot;)} ^. x . _2
&quot;hi&quot;</code></pre><p>The expression <code>Foo {_x = (True, &quot;hi&quot;)} ^. x . _2</code> was comprised of a few parts:</p><pre><code class="text language-text">        Structure           Path
           |                 |
/----------+----------\    /-+--\
Foo {_x = (True, &quot;hi&quot;)} ^. x . _2
                 \+-/   \/
                  |      |
                Focus  Action (&quot;view&quot;)</code></pre><p>The <em>path</em> indicates a <em>focus</em> within the <em>structure</em>. The <em>action</em> does something about whatever is being focused on. Notice that the parts of the path are composed using regular function composition <code>(.)</code>!</p><p>An example using <code>over</code> (aka “modify”/ <code>%~</code>):</p><pre><code class="haskell language-haskell">&gt;&gt;&gt; Foo {_x = (True, &quot;hi&quot;)} &amp; x . _1 %~ not
Foo {_x = (False,&quot;hi&quot;)}</code></pre><p>Lenses subsume the accessor pattern, bundling something akin to a getter and a setter into a single value. For things like structs, we can even define multiple lenses for the same field.</p><h2 id="notes-on-types">Notes on types</h2><p>Lenses are described (in the <code>lens</code> package and more broadly in convention) by the type <code>Lens&#39; s a</code> where <code>s</code> is the type of structure and <code>a</code> is the type of focus, e.g.:</p><pre><code class="haskell language-haskell">_1 :: Lens&#39; (a, b) a
-- s ~ (a, b)  i.e. _1 works on pair structures
-- a ~ a       i.e. _1 focuses on the first element of the pair</code></pre><p>The lens actions have the following types:</p><pre><code class="haskell language-haskell">-- Simple versions (i.e. specialized to s ~ t and a ~ b):
view :: Lens&#39; s a -&gt; s        -&gt; a
set  :: Lens&#39; s a -&gt; a        -&gt; s -&gt; s
over :: Lens&#39; s a -&gt; (a -&gt; a) -&gt; s -&gt; s

-- Polymorphic versions:
view :: Lens s s a a -&gt; s        -&gt; a       -- the same, since it can&#39;t modify
set  :: Lens s t a b -&gt; b        -&gt; s -&gt; t  -- often t involves b
over :: Lens s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t</code></pre><p>The infix/ operator variants are the same but with some arguments shuffled around.</p><p>I think the name <code>over</code> makes more sense in the long-hand form:</p><pre><code class="haskell language-haskell">&gt;&gt;&gt; let f = Foo{_x = (True, &quot;hello&quot;)}
&gt;&gt;&gt; over (x . _2) (`mappend` &quot; there&quot;) f
Foo{_x=(True, &quot;hello there&quot;)}</code></pre><h2 id="creating-lenses">Creating lenses</h2><p>The template Haskell tool <code>makeLenses</code> used above to create <code>x :: Lens&#39; Foo (Bool, String)</code> could have been replaced by a manual definition using the <code>lens</code> helper:</p><pre><code class="haskell language-haskell">lens :: (s -&gt; a) -&gt; (s -&gt; a -&gt; s) -&gt; Lens&#39; s a

x :: Lens&#39; Foo (Bool, String)
x = lens _x (\foo x&#39; -&gt; foo{_x = x&#39;})</code></pre><p>Note</p><pre><code class="haskell language-haskell">_x :: Foo -&gt; (Bool, String)  -- &quot;getter&quot;; from definition of Foo as record type
\foo x&#39; -&gt; foo{_x = x&#39;} :: Foo -&gt; (Bool, String) -&gt; Foo -- &quot;setter&quot;</code></pre><h2 id="interesting-combinators-actions">Interesting combinators/ actions</h2><pre><code class="haskell language-haskell">&gt;&gt;&gt; Right &quot;right&quot; ^. chosen
&quot;right&quot;
&gt;&gt;&gt; Left &quot;left&quot; ^. chosen
&quot;left&quot;

-- Using simplified types:
(+~), (-~), (*~) :: Num a =&gt; Lens&#39; s a -&gt; a -&gt; s -&gt; s
&gt;&gt;&gt; (True, 10) &amp; _2 *~ 3
(True,30)
(//~) :: Fractional a =&gt; Lens&#39; s a -&gt; a -&gt; s -&gt; s

-- &quot;update by raising to power&quot;; not related to viewing:
(^~)  :: (Integral e, Num a)        =&gt; Lens&#39; s a -&gt; e -&gt; s -&gt; s
(^^~) :: (Integral e, Fractional a) =&gt; Lens&#39; s a -&gt; e -&gt; s -&gt; s
(**~) :: Floating a                 =&gt; Lens&#39; s a -&gt; e -&gt; s -&gt; s

(||~), (&amp;&amp;~) :: Lens s Bool -&gt; Bool -&gt; s -&gt; s

(&lt;&gt;~) :: Semigroup m =&gt; Lens s m -&gt; m -&gt; s -&gt; s
&gt;&gt;&gt; (&quot;foo&quot;, True) &amp; _1 &lt;&gt;~ &quot;bar&quot;
(&quot;foobar&quot;,True)</code></pre><h3 id="operator-conventions">Operator conventions</h3><p>There are a few conventions for deciphering the meaning of a lens operator without looking it up:</p><ul><li><strong>^</strong> Often means viewing/ getting something</li><li><strong>.</strong> Is sort of the end of the sentence (“<code>^.</code>” = <em>get</em> the focus without doing anything else)</li><li><strong>%</strong> Means <strong>mod</strong>ify using a function</li><li><strong>~</strong> Means update/ set</li></ul><p>And some “adverb”-like symbols (used as prefixes to setting/ updating actions):</p><ul><li><strong>&lt;</strong> In addition to modifying focus, return the new value <code>(&quot;a&quot;, 1) &amp; _2 &lt;+~ 5 == (6, (&quot;a&quot;, 6))</code></li><li><strong>&lt;&lt;</strong> In addition to modifying the focus, return the old value <code>(&quot;a&quot;, 1) &amp; _2 &lt;&lt;+~ 5 == (1, (&quot;a&quot;, 6))</code></li></ul><h2 id="lens-laws">Lens laws</h2><p>The lens laws (like typeclass laws for polymorphic code) help reason about lens-y code and can indicate why odd-feeling or poorly behaved lenses feel or behave the way they do. Note:</p><blockquote><p>Typically you should follow these laws when writing field accessors and basic data accessors, but there’s a bit more wiggle room if you’re using lenses to emulate virtual fields or to do input cleanup/correction.</p><p><em>via Penner in</em> Optics by Example</p></blockquote><pre><code class="haskell language-haskell">-- 1. set then get
\lens val s -&gt; view lens (set lens val s) === val

-- 2. get then set (set with get)
\lens s -&gt; set lens (view lens s) s === s

-- 3. set then set
\lens val1 val2 s -&gt; set lens val2 (set lens val1 s) === set lens val2 s</code></pre><p>You can break the laws if you really need to, but that often indicates you should be reaching for a different kind of optic.</p><p>Lenses which break the laws seem like they base results off of existing data when they shouldn’t, e.g.:</p><pre><code class="haskell language-haskell">foobar :: Lens&#39; Foo (Bool, String)
foobar = lens _x (\f (_, s) -&gt; Foo (not $ f ^. x._1, s))</code></pre><p>In this case, the setter is a function of the existing <code>Bool</code> value and ignores the new value given by the caller of the setter.</p><pre><code class="haskell language-haskell">&gt;&gt;&gt; let (val1, val2) = ((True, &quot;val1&quot;), (True, &quot;val2&quot;))
-- 1. set then get
&gt;&gt;&gt; view foobar (set foobar val1 f) == val1
False
-- 2. get then set
&gt;&gt;&gt; set foobar (view foobar f) f == f
False
-- 3. set then set
&gt;&gt;&gt; set foobar (True, &quot;val2&quot;) (set foobar (True, &quot;val1&quot;) f) == set foobar val2 f
False</code></pre><h2 id="resources">Resources</h2><ul><li><a href="https://github.com/ekmett/lens/wiki/History-of-Lenses"><em>History of Lenses</em>, Ed Kmett</a></li></ul></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2021-07-26T18:56">2021-07-26</time></div></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header">Backlinks</h3><ul class="backlinks"><li><span class="zettel-link-container cf"><span class="zettel-link" title="2021-07-26T18:57"><a href="24a6b373">Folds</a></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><p>Folds are <span class="zettel-link-container cf"><span class="zettel-link" title="2021-07-26T18:52"><a href="997fa496">Optics</a></span></span> that work like queries of a structure. Folds can focus <em>many</em> things (zero or more; compared to <span class="zettel-link-container folge"><span class="zettel-link" title="2021-07-26T18:56"><a href="89c5b6c3">Lenses</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> which can only focus exactly one thing) but can only <em>get</em> the focus (not set/ update).</p></div></li><li class="item"><div class="pandoc"><p><code>to</code> is a <code>Getter</code>; a 1-to-1 mapping (get half of a <span class="zettel-link-container folge"><span class="zettel-link" title="2021-07-26T18:56"><a href="89c5b6c3">Lenses</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span>), so it never fails and can always transform input to output.</p></div></li></ul></li><li><span class="zettel-link-container cf"><span class="zettel-link" title="2020-10-19T13:23"><a href=".">Index</a></span></span><ul class="context-list" style="zoom: 85%;"></ul></li></ul><h3 class="ui header"><span title="Backlinks from folgezettel parents">Uplinks</span></h3><ul class="backlinks"><li><span class="zettel-link-container folge"><span class="zettel-link" title="2021-07-26T18:52"><a href="997fa496">Optics</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><span class="zettel-link-container folge"><span class="zettel-link" title="2021-07-26T18:56"><a href="89c5b6c3">Lenses</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span></div></li><li class="item"><div class="pandoc"><p>Optics also separate the <em>access</em> of data from the <em>action</em> on data (see <span class="zettel-link-container folge"><span class="zettel-link" title="2021-07-26T18:56"><a href="89c5b6c3">Lenses</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> for concrete examples).</p></div></li></ul></li></ul></nav><nav class="ui bottom attached icon compact inverted menu blue" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="right item" href="impulse" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.35.3" /></a></div></div></div></body></html>